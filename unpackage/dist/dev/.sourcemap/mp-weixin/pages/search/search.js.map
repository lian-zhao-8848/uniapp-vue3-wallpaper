{"version":3,"file":"search.js","sources":["pages/search/search.vue","D:/text/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n\t<view class=\"searchLayout\">\n\t\t<view class=\"search\">\n\t\t\t<uni-search-bar @confirm=\"onSearch\" @cancel=\"onClear\" @clear=\"onClear\" focus placeholder=\"搜索\" v-model=\"queryParams.keyword\"></uni-search-bar>\n\t\t</view>\n\n\t\t<view v-if=\"!classList.length || noSearch\">\n\t\t\t<view class=\"history\" v-if=\"historySearch.length\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">最近搜索</view>\n\t\t\t\t\t<view class=\"icon\" @click=\"removeHistory\">\n\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"25\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in historySearch\" :key=\"tab\" @click=\"clickTab(tab)\">{{ tab }}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"recommend\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">热门搜索</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in recommendList\" :key=\"tab\" @click=\"clickTab(tab)\">{{ tab }}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"noSearch\" v-if=\"noSearch\">\n\t\t\t<uv-empty mode=\"search\" icon=\"http://cdn.uviewui.com/uview/empty/search.png\"></uv-empty>\n\t\t</view>\n\n\t\t<view v-else>\n\t\t\t<view class=\"list\">\n\t\t\t\t<navigator :url=\"`/pages/preview/preview?id=${item._id}`\" class=\"item\" v-for=\"item in classList\" :key=\"item._id\">\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\n\t\t\t\t</navigator>\n\t\t\t</view>\n\t\t\t<view class=\"loadingLayout\" v-if=\"noData || classList.length\"><uni-load-more :status=\"noData ? 'noMore' : 'loading'\" /></view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { onLoad, onUnload, onReachBottom } from '@dcloudio/uni-app';\nimport { apiGetSearchWall } from '@/api/apis.js';\n//查询参数\nconst queryParams = ref({\n\tpageNum: 1,\n\tpageSize: 12,\n\tkeyword: ''\n});\n\n//搜索历史词\nconst historySearch = ref(uni.getStorageSync('historySearch') || []);\n\n//热门搜索词\nconst recommendList = ref(['美女', '帅哥', '宠物', '卡通']);\n\n//没有更多\nconst noData = ref(false);\n//没有搜索结果\nconst noSearch = ref(false);\n\n//搜索结果列表\nconst classList = ref([]);\n\n//点击搜索\nconst onSearch = () => {\n\tuni.showLoading();\n\thistorySearch.value = [...new Set([queryParams.value.keyword, ...historySearch.value])];\n\tuni.setStorageSync('historySearch', historySearch.value);\n\tinitParams(queryParams.value.keyword);\n\tsearchData();\n};\n\n//点击清除按钮\nconst onClear = () => {\n\tinitParams();\n};\n\n//点击标签进行搜索\nconst clickTab = (value) => {\n\tinitParams(value);\n\t// queryParams.value.keyword = value;\n\tonSearch();\n};\n\n//点击清空搜索记录\nconst removeHistory = () => {\n\tuni.showModal({\n\t\ttitle: '是否清空历史搜索？',\n\t\tsuccess: (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\tuni.removeStorageSync('historySearch');\n\t\t\t\thistorySearch.value = [];\n\t\t\t}\n\t\t}\n\t});\n};\nconst searchData = async () => {\n\ttry {\n\t\tlet res = await apiGetSearchWall(queryParams.value);\n\t\tclassList.value = [...classList.value, ...res.data].slice(0, 10);\n\t\tuni.setStorageSync('storageClassList', classList.value);\n\t\tif (queryParams.value.pageSize > res.data.length) noData.value = true;\n\t\tif (res.data.length === 0 && classList.value.length === 0) noData.value = true;\n\t} finally {\n\t\tuni.hideLoading();\n\t}\n};\n\nconst initParams = (val = '') => {\n\tclassList.value = [];\n\tnoData.value = false;\n\tnoSearch.value = false;\n\tqueryParams.value = {\n\t\tpageNum: 1,\n\t\tpageSize: 12,\n\t\tkeyword: val || ''\n\t};\n};\n//触底加载更多\nonReachBottom(() => {\n\tif (noData.value) return;\n\tqueryParams.value.pageNum++;\n\tsearchData();\n});\n\n//关闭有页面\nonUnload(() => {\n\tuni.removeStorageSync('storageClassList');\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.searchLayout {\n\t.search {\n\t\tpadding: 0 10rpx;\n\t}\n\t.topTitle {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tfont-size: 32rpx;\n\t\tcolor: #999;\n\t}\n\t.history {\n\t\tpadding: 30rpx;\n\t}\n\t.recommend {\n\t\tpadding: 30rpx;\n\t}\n\t.tabs {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tflex-wrap: wrap;\n\t\tpadding-top: 20rpx;\n\t\t.tab {\n\t\t\tbackground: #f4f4f4;\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #333;\n\t\t\tpadding: 10rpx 28rpx;\n\t\t\tborder-radius: 50rpx;\n\t\t\tmargin-right: 20rpx;\n\t\t\tmargin-top: 20rpx;\n\t\t}\n\t}\n\t.list {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3, 1fr);\n\t\tgap: 5rpx;\n\t\tpadding: 20rpx 5rpx;\n\t\t.item {\n\t\t\theight: 440rpx;\n\t\t\timage {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","import MiniProgramPage from 'C:/Users/mlz/Desktop/wallpaper-kt/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiGetSearchWall","onReachBottom","onUnload"],"mappings":";;;;;;;;;;;;;;;;;;;;AAiDA,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACV,CAAC;AAGD,UAAM,gBAAgBA,cAAG,IAACC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AAGnE,UAAM,gBAAgBD,cAAG,IAAC,CAAC,MAAM,MAAM,MAAM,IAAI,CAAC;AAGlD,UAAM,SAASA,cAAAA,IAAI,KAAK;AAExB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAG1B,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AAGxB,UAAM,WAAW,MAAM;AACtBC,oBAAG,MAAC,YAAW;AACf,oBAAc,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,cAAc,KAAK,CAAC,CAAC;AACtFA,oBAAAA,MAAI,eAAe,iBAAiB,cAAc,KAAK;AACvD,iBAAW,YAAY,MAAM,OAAO;AACpC;IACD;AAGA,UAAM,UAAU,MAAM;AACrB;IACD;AAGA,UAAM,WAAW,CAAC,UAAU;AAC3B,iBAAW,KAAK;AAEhB;IACD;AAGA,UAAM,gBAAgB,MAAM;AAC3BA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChBA,gCAAI,kBAAkB,eAAe;AACrC,0BAAc,QAAQ;UACtB;AAAA,QACD;AAAA,MACH,CAAE;AAAA,IACF;AACA,UAAM,aAAa,YAAY;AAC9B,UAAI;AACH,YAAI,MAAM,MAAMC,SAAAA,iBAAiB,YAAY,KAAK;AAClD,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,IAAI,EAAE,MAAM,GAAG,EAAE;AAC/DD,sBAAAA,MAAI,eAAe,oBAAoB,UAAU,KAAK;AACtD,YAAI,YAAY,MAAM,WAAW,IAAI,KAAK;AAAQ,iBAAO,QAAQ;AACjE,YAAI,IAAI,KAAK,WAAW,KAAK,UAAU,MAAM,WAAW;AAAG,iBAAO,QAAQ;AAAA,MAC5E,UAAW;AACTA,sBAAG,MAAC,YAAW;AAAA,MACf;AAAA,IACF;AAEA,UAAM,aAAa,CAAC,MAAM,OAAO;AAChC,gBAAU,QAAQ;AAClB,aAAO,QAAQ;AACf,eAAS,QAAQ;AACjB,kBAAY,QAAQ;AAAA,QACnB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS,OAAO;AAAA,MAClB;AAAA,IACA;AAEAE,kBAAAA,cAAc,MAAM;AACnB,UAAI,OAAO;AAAO;AAClB,kBAAY,MAAM;AAClB;IACD,CAAC;AAGDC,kBAAAA,SAAS,MAAM;AACdH,0BAAI,kBAAkB,kBAAkB;AAAA,IACzC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrID,GAAG,WAAW,eAAe;"}